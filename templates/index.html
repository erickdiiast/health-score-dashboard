<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Score Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-heartbeat"></i>
                    <h1>Health Score Dashboard</h1>
                </div>
                <div class="actions">
                    <button class="btn btn-secondary" onclick="loadSampleData()">
                        <i class="fas fa-database"></i> Dados de Exemplo
                    </button>
                    <label class="btn btn-primary" for="file-upload">
                        <i class="fas fa-upload"></i> Upload CSV/Excel
                        <input type="file" id="file-upload" accept=".csv,.xlsx,.xls" onchange="handleFileUpload(event)">
                    </label>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Estado Vazio -->
            <div id="empty-state" class="empty-state">
                <div class="empty-state-content">
                    <i class="fas fa-chart-line"></i>
                    <h2>Bem-vindo ao Health Score Dashboard</h2>
                    <p>Fa√ßa upload de um CSV com dados dos jogadores ou use os dados de exemplo para come√ßar.</p>
                    <div class="empty-actions">
                        <button class="btn btn-primary btn-lg" onclick="loadSampleData()">
                            <i class="fas fa-play"></i> Ver Demonstra√ß√£o
                        </button>
                    </div>
                    <div class="file-format">
                        <h4>Formatos aceitos: CSV ou Excel (.xlsx)</h4>
                        <p style="margin-top: 10px; color: #94a3b8; font-size: 13px;">
                            <strong>Colunas CRM suportadas:</strong><br>
                            pid, nivel_vip (1=Ametista, 2=Top√°zio, 3=Esmeralda, 4=Opala, 5=Berilo), lastLogin, qtd_logins_3d, qtd_compras_7d, qtd_torneios_3d, qtd_maratonas_3d, qtd_missoes_3d, qtd_promos_3d, ultima_compra
                        </p>
                    </div>
                </div>
            </div>

            <!-- Dashboard com Abas -->
            <div id="dashboard" class="dashboard hidden">
                <!-- Region Tabs (Superior) -->
                <nav class="region-tabs">
                    <button class="region-btn active" onclick="showRegion('all')" id="region-btn-all">
                        <i class="fas fa-globe"></i> Todos
                    </button>
                    <button class="region-btn" onclick="showRegion('es')" id="region-btn-es">
                        <img src="https://flagcdn.com/w20/es.png" alt="ES" class="flag-icon"> Espanhol
                        <span class="region-badge">es_AR, es_ES, es_LA, es_MX</span>
                    </button>
                    <button class="region-btn" onclick="showRegion('br')" id="region-btn-br">
                        <img src="https://flagcdn.com/w20/br.png" alt="BR" class="flag-icon"> Brasil
                        <span class="region-badge">pt_BR</span>
                    </button>
                    <button class="region-btn" onclick="showRegion('int')" id="region-btn-int">
                        <i class="fas fa-globe-americas"></i> Internacional
                        <span class="region-badge">Outros</span>
                    </button>
                </nav>

                <!-- VIP Level Tabs -->
                <nav class="vip-tabs">
                    <button class="vip-btn active" onclick="showVIP('all')" id="vip-btn-all">
                        <i class="fas fa-gem"></i> Todos VIPs
                    </button>
                    <button class="vip-btn" onclick="showVIP('1')" id="vip-btn-1">
                        <i class="fas fa-gem" style="color: #9B59B6;"></i> Ametista
                    </button>
                    <button class="vip-btn" onclick="showVIP('2')" id="vip-btn-2">
                        <i class="fas fa-gem" style="color: #F39C12;"></i> Top√°zio
                    </button>
                    <button class="vip-btn" onclick="showVIP('3')" id="vip-btn-3">
                        <i class="fas fa-gem" style="color: #27AE60;"></i> Esmeralda
                    </button>
                    <button class="vip-btn" onclick="showVIP('4')" id="vip-btn-4">
                        <i class="fas fa-gem" style="color: #E74C3C;"></i> Opala
                    </button>
                    <button class="vip-btn" onclick="showVIP('5')" id="vip-btn-5">
                        <i class="fas fa-gem" style="color: #3498DB;"></i> Berilo
                    </button>
                </nav>

                <!-- Navigation Tabs (Inferior) -->
                <nav class="dashboard-tabs">
                    <button class="tab-btn active" onclick="showTab('tab-overview')" id="tab-btn-overview">
                        <i class="fas fa-chart-pie"></i> Vis√£o Geral
                    </button>
                    <button class="tab-btn" onclick="showTab('tab-executivo')" id="tab-btn-executivo">
                        <i class="fas fa-presentation"></i> Resumo Executivo
                    </button>
                    <button class="tab-btn" onclick="showTab('tab-vip')" id="tab-btn-vip">
                        <i class="fas fa-gem"></i> An√°lise VIP
                    </button>
                    <button class="tab-btn" onclick="showTab('tab-players')" id="tab-btn-players">
                        <i class="fas fa-users"></i> Jogadores
                    </button>
                    <button class="tab-btn" onclick="showTab('tab-clusters')" id="tab-btn-clusters">
                        <i class="fas fa-layer-group"></i> Clusters
                    </button>
                    <button class="tab-btn" onclick="showTab('tab-benchmarks')" id="tab-btn-benchmarks">
                        <i class="fas fa-cogs"></i> Benchmarks
                    </button>
                </nav>

                <!-- Tab: Vis√£o Geral -->
                <div id="tab-overview" class="tab-content active">
                    <!-- KPI Cards -->
                    <section class="kpi-section">
                        <div class="kpi-grid">
                            <div class="kpi-card">
                                <div class="kpi-icon bg-blue">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">Total Jogadores <span class="info-tooltip"><span class="tooltip-text">Total de jogadores analisados no snapshot atual. Comparado com o per√≠odo anterior para mostrar tend√™ncia.</span></span></span>
                                    <span class="kpi-value" id="total-jogadores">-</span>
                                </div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-icon bg-green">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">% Ativos <span class="info-tooltip"><span class="tooltip-text">Porcentagem de jogadores com login nos √∫ltimos 3 dias. M√©trica chave de sa√∫de da base.</span></span></span>
                                    <span class="kpi-value" id="percentual-ativos">-</span>
                                </div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-icon bg-purple">
                                    <i class="fas fa-star"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">Pontua√ß√£o Geral <span class="info-tooltip"><span class="tooltip-text">M√©dia do Health Score de todos os jogadores. Composto por 70% Compras + 30% Engajamento.</span></span></span>
                                    <span class="kpi-value" id="pontuacao-geral">-</span>
                                </div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-icon bg-orange">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">Elite <span class="info-tooltip"><span class="tooltip-text">Jogadores com Health Score ‚â• 80. S√£o os jogadores mais valiosos da base.</span></span></span>
                                    <span class="kpi-value" id="percentual-elite">-</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Health Scores -->
                    <section class="scores-section">
                        <h3><i class="fas fa-heartbeat"></i> Scores de Sa√∫de (Composi√ß√£o: Engajamento 30% + Compras 70%)
                        <span class="info-tooltip tooltip-wide"><span class="tooltip-text">O Health Score √© calculado com base em dois pilares: COMPRAS (70%) - quantidade de compras nos √∫ltimos 7 dias (40%), ticket m√©dio (35%) e rec√™ncia da √∫ltima compra (25%); e ENGENHARIA (30%) - torneios, maratonas, miss√µes, promo√ß√µes e login nos √∫ltimos 3 dias.</span></span>
                    </h3>
                        <div class="scores-grid">
                            <div class="score-card">
                                <div class="score-header">
                                    <span class="score-title">Engajamento (30%) <span class="info-tooltip"><span class="tooltip-text">M√©dia de atividades nos √∫ltimos 3 dias: torneios, maratonas, miss√µes, promo√ß√µes e logins. Considera apenas jogadores que participaram de cada atividade.</span></span></span>
                                    <i class="fas fa-gamepad"></i>
                                </div>
                                <div class="score-value" id="score-engajamento">-</div>
                                <div class="score-bar">
                                    <div class="score-progress" id="bar-engajamento"></div>
                                </div>
                            </div>
                            <div class="score-card">
                                <div class="score-header">
                                    <span class="score-title">Compras (70%) <span class="info-tooltip"><span class="tooltip-text">Baseado em 3 fatores: quantidade de compras nos √∫ltimos 7 dias (40%), ticket m√©dio (35%) e rec√™ncia da √∫ltima compra (25%). Benchmarks calculados dinamicamente da base.</span></span></span>
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <div class="score-value" id="score-compras">-</div>
                                <div class="score-bar">
                                    <div class="score-progress" id="bar-compras"></div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Charts Section -->
                    <section class="charts-section">
                        <div class="chart-row">
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-pie"></i> Distribui√ß√£o por Categoria <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Distribui√ß√£o percentual dos jogadores em 6 categorias baseadas no Health Score: Elite (‚â•80), Muito Bom (65-79), Est√°vel (50-64), Baixo (35-49), Risco Receita (<35, compras < engajamento) e Risco Engajamento (<35, engajamento ‚â§ compras).</span></span></h4>
                                <canvas id="categoriaChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-bar"></i> Composi√ß√£o do Health Score <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Vis√£o detalhada da composi√ß√£o do Health Score m√©dio da base: Score de Login (baseado em √∫ltimo acesso e frequ√™ncia), Score de Engajamento (atividades nos √∫ltimos 3 dias) e Score de Compras (quantidade, ticket e rec√™ncia).</span></span></h4>
                                <canvas id="scoresChart"></canvas>
                            </div>
                        </div>
                    </section>

                    <!-- Categorias Detalhadas -->
                    <section class="categorias-section">
                        <h3><i class="fas fa-layer-group"></i> Distribui√ß√£o de Categorias <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Detalhamento de cada categoria de sa√∫de com porcentagem da base total. Cada categoria representa um segmento de jogadores com comportamentos similares de compra e engajamento.</span></span></h3>
                        <div class="categorias-grid">
                            <div class="categoria-item elite">
                                <div class="categoria-header">
                                    <span class="categoria-nome">Elite <span class="info-tooltip"><span class="tooltip-text">Score ‚â• 80. Jogadores com excelente performance em compras e engajamento. S√£o a base mais valiosa e devem receber aten√ß√£o especial para reten√ß√£o.</span></span></span>
                                    <span class="categoria-percentual" id="cat-elite">-</span>
                                </div>
                                <div class="categoria-bar">
                                    <div class="categoria-progress" id="progress-elite"></div>
                                </div>
                                <span class="categoria-desc">Score ‚â• 80</span>
                            </div>
                            <div class="categoria-item muito-bom">
                                <div class="categoria-header">
                                    <span class="categoria-nome">Muito Bom <span class="info-tooltip"><span class="tooltip-text">Score 65-79. Jogadores engajados com boa frequ√™ncia de compras. Potencial para se tornarem Elite com incentivos adequados.</span></span></span>
                                    <span class="categoria-percentual" id="cat-muito-bom">-</span>
                                </div>
                                <div class="categoria-bar">
                                    <div class="categoria-progress" id="progress-muito-bom"></div>
                                </div>
                                <span class="categoria-desc">Score 65-79</span>
                            </div>
                            <div class="categoria-item estavel">
                                <div class="categoria-header">
                                    <span class="categoria-nome">Est√°vel <span class="info-tooltip"><span class="tooltip-text">Score 50-64. Jogadores com comportamento consistente mas com espa√ßo para crescimento. Foco em aumentar frequ√™ncia de compras.</span></span></span>
                                    <span class="categoria-percentual" id="cat-estavel">-</span>
                                </div>
                                <div class="categoria-bar">
                                    <div class="categoria-progress" id="progress-estavel"></div>
                                </div>
                                <span class="categoria-desc">Score 50-64</span>
                            </div>
                            <div class="categoria-item baixo">
                                <div class="categoria-header">
                                    <span class="categoria-nome">Baixo <span class="info-tooltip"><span class="tooltip-text">Score 35-49. Jogadores com baixa atividade. Requerem a√ß√µes de reengajamento para evitar churn.</span></span></span>
                                    <span class="categoria-percentual" id="cat-baixo">-</span>
                                </div>
                                <div class="categoria-bar">
                                    <div class="categoria-progress" id="progress-baixo"></div>
                                </div>
                                <span class="categoria-desc">Score 35-49</span>
                            </div>
                            <div class="categoria-item risco-receita">
                                <div class="categoria-header">
                                    <span class="categoria-nome">Risco: Queda em Receita <span class="info-tooltip"><span class="tooltip-text">Score < 35 onde engajamento > compras. Jogadores est√£o ativos mas n√£o comprando. Prioridade para campanhas de convers√£o.</span></span></span>
                                    <span class="categoria-percentual" id="cat-risco-receita">-</span>
                                </div>
                                <div class="categoria-bar">
                                    <div class="categoria-progress" id="progress-risco-receita"></div>
                                </div>
                                <span class="categoria-desc">Score < 35 | Compras < Engajamento</span>
                            </div>
                            <div class="categoria-item risco-engajamento">
                                <div class="categoria-header">
                                    <span class="categoria-nome">Risco: Queda em Engajamento <span class="info-tooltip"><span class="tooltip-text">Score < 35 onde compras ‚â• engajamento. Jogadores compram pouco e t√™m baixo engajamento. Risco iminente de churn total.</span></span></span>
                                    <span class="categoria-percentual" id="cat-risco-engajamento">-</span>
                                </div>
                                <div class="categoria-bar">
                                    <div class="categoria-progress" id="progress-risco-engajamento"></div>
                                </div>
                                <span class="categoria-desc">Score < 35 | Engajamento ‚â§ Compras</span>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Tab: Resumo Executivo -->
                <div id="tab-executivo" class="tab-content">
                    <section class="executivo-section">
                        <div class="executivo-header">
                            <h3><i class="fas fa-presentation"></i> Resumo Executivo para Apresenta√ß√µes</h3>
                        </div>
                        
                        <!-- Salvar Snapshot -->
                        <div class="salvar-snapshot-box">
                            <h4><i class="fas fa-save"></i> Salvar Dados do Dia</h4>
                            <div class="salvar-snapshot-form">
                                <div class="filtro-grupo">
                                    <label>Data do arquivo:</label>
                                    <input type="date" id="snapshot-data" placeholder="YYYY-MM-DD">
                                </div>
                                <button class="btn btn-primary" onclick="salvarSnapshot()">
                                    <i class="fas fa-save"></i> Salvar Snapshot
                                </button>
                            </div>
                            <p class="snapshot-ajuda">Informe a data do arquivo ou deixe em branco para usar a data atual.</p>
                        </div>
                        
                        <!-- Filtros do Hist√≥rico -->
                        <div class="filtros-historico">
                            <div class="filtro-grupo">
                                <label>Regi√£o:</label>
                                <select id="filtro-hist-regiao" onchange="carregarHistorico()">
                                    <option value="all">Todas</option>
                                    <option value="br">Brasil</option>
                                    <option value="es">Espanhol</option>
                                    <option value="int">Internacional</option>
                                </select>
                            </div>
                            <div class="filtro-grupo">
                                <label>VIP:</label>
                                <select id="filtro-hist-vip" onchange="carregarHistorico()">
                                    <option value="all">Todos</option>
                                    <option value="1">Ametista</option>
                                    <option value="2">Top√°zio</option>
                                    <option value="3">Esmeralda</option>
                                    <option value="4">Opala</option>
                                    <option value="5">Berilo</option>
                                </select>
                            </div>
                            <div class="filtro-grupo">
                                <label>Dias:</label>
                                <select id="filtro-hist-dias" onchange="carregarHistorico()">
                                    <option value="7">7 dias</option>
                                    <option value="15">15 dias</option>
                                    <option value="30" selected>30 dias</option>
                                </select>
                            </div>
                        </div>

                        <!-- KPIs Executivos -->
                        <div class="kpi-grid executivo-kpis" id="executivo-kpis">
                            <div class="kpi-card kpi-executivo">
                                <div class="kpi-icon bg-blue">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">Total Jogadores <span class="info-tooltip"><span class="tooltip-text">Total de jogadores analisados no snapshot atual. Comparado com o per√≠odo anterior para mostrar tend√™ncia.</span></span></span>
                                    <span class="kpi-value" id="exec-total-jogadores">-</span>
                                    <span class="kpi-variacao" id="exec-var-total"></span>
                                </div>
                            </div>
                            <div class="kpi-card kpi-executivo">
                                <div class="kpi-icon bg-green">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">% Ativos <span class="info-tooltip"><span class="tooltip-text">Porcentagem de jogadores com login nos √∫ltimos 3 dias. M√©trica chave de sa√∫de da base.</span></span></span>
                                    <span class="kpi-value" id="exec-percentual-ativos">-</span>
                                    <span class="kpi-variacao" id="exec-var-ativos"></span>
                                </div>
                            </div>
                            <div class="kpi-card kpi-executivo">
                                <div class="kpi-icon bg-purple">
                                    <i class="fas fa-star"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">Score Geral <span class="info-tooltip"><span class="tooltip-text">M√©dia do Health Score de todos os jogadores. Varia√ß√£o mostra se a base est√° melhorando ou piorando.</span></span></span>
                                    <span class="kpi-value" id="exec-score-geral">-</span>
                                    <span class="kpi-variacao" id="exec-var-score"></span>
                                </div>
                            </div>
                            <div class="kpi-card kpi-executivo">
                                <div class="kpi-icon bg-orange">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">Score Compras <span class="info-tooltip"><span class="tooltip-text">M√©dia do score de compras (70% do total). Composto por quantidade, ticket m√©dio e rec√™ncia.</span></span></span>
                                    <span class="kpi-value" id="exec-score-compras">-</span>
                                    <span class="kpi-variacao" id="exec-var-compras"></span>
                                </div>
                            </div>
                            <div class="kpi-card kpi-executivo">
                                <div class="kpi-icon bg-teal">
                                    <i class="fas fa-gamepad"></i>
                                </div>
                                <div class="kpi-info">
                                    <span class="kpi-label">Score Engajamento <span class="info-tooltip"><span class="tooltip-text">M√©dia do score de engajamento (30% do total). Baseado em atividades nos √∫ltimos 3 dias.</span></span></span>
                                    <span class="kpi-value" id="exec-score-engajamento">-</span>
                                    <span class="kpi-variacao" id="exec-var-engajamento"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Distribui√ß√£o de Clusters -->
                        <div class="chart-row">
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-pie"></i> Distribui√ß√£o por Cluster <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Distribui√ß√£o atual dos jogadores nos 6 clusters de sa√∫de. Permite visualizar rapidamente a composi√ß√£o da base e identificar concentra√ß√µes de risco.</span></span></h4>
                                <canvas id="execClustersChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-line"></i> Evolu√ß√£o dos Indicadores <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Evolu√ß√£o temporal dos principais indicadores. Score Geral mostra a m√©dia de sa√∫de da base e % Ativos mostra o n√≠vel de engajamento ao longo do tempo.</span></span></h4>
                                <canvas id="execEvolucaoChart"></canvas>
                            </div>
                        </div>

                        <!-- Tabela de Clusters -->
                        <div class="clusters-resumo">
                            <h4><i class="fas fa-table"></i> Resumo por Cluster <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Detalhamento quantitativo de cada cluster: quantidade absoluta, porcentagem da base total e tend√™ncia comparada ao per√≠odo anterior.</span></span></h4>
                            <table class="data-table" id="exec-clusters-table">
                                <thead>
                                    <tr>
                                        <th>Cluster</th>
                                        <th>Quantidade</th>
                                        <th>% do Total</th>
                                        <th>Tend√™ncia</th>
                                    </tr>
                                </thead>
                                <tbody id="exec-clusters-body">
                                </tbody>
                            </table>
                        </div>

                        <!-- Hist√≥rico -->
                        <div class="historico-section">
                            <h4><i class="fas fa-history"></i> Hist√≥rico de Snapshots <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Hist√≥rico completo de snapshots salvos. Cada linha representa uma an√°lise di√°ria. √â poss√≠vel deletar snapshots individuais se necess√°rio.</span></span></h4>
                            <div class="table-container">
                                <table class="data-table" id="historico-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Data</th>
                                            <th>Total Jogadores</th>
                                            <th>% Ativos</th>
                                            <th>Score Geral</th>
                                            <th>Elite</th>
                                            <th>Riscos</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="historico-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Tab: An√°lise VIP -->
                <div id="tab-vip" class="tab-content">
                    <section class="vip-section">
                        <h3><i class="fas fa-gem"></i> An√°lise por N√≠vel VIP <span class="info-tooltip tooltip-wide"><span class="tooltip-text">An√°lise segmentada por n√≠vel VIP (Ametista, Top√°zio, Esmeralda, Opala, Berilo). Mostra comportamento, sa√∫de e distribui√ß√£o de cada segmento VIP.</span></span></h3>
                        <div class="vip-grid" id="vip-grid">
                            <!-- Cards VIP ser√£o inseridos aqui via JS -->
                        </div>
                        
                        <div class="chart-row">
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-pie"></i> Distribui√ß√£o por N√≠vel VIP <span class="info-tooltip"><span class="tooltip-text">Distribui√ß√£o percentual da base entre os 5 n√≠veis VIP.</span></span></h4>
                                <canvas id="vipChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-bar"></i> Scores M√©dios por N√≠vel VIP <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Compara√ß√£o do Health Score m√©dio entre n√≠veis VIP. Permite identificar quais segmentos est√£o mais saud√°veis.</span></span></h4>
                                <canvas id="vipScoresChart"></canvas>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Tab: Jogadores -->
                <div id="tab-players" class="tab-content">
                    <!-- Top Jogadores -->
                    <section class="top-section">
                        <h3><i class="fas fa-trophy"></i> Top 10 Jogadores <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Os 10 jogadores com maior Health Score atual. Ranking baseado na pontua√ß√£o combinada de compras (70%) e engajamento (30%).</span></span></h3>
                        <div class="table-container">
                            <table class="data-table" id="top-jogadores-table">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Player ID</th>
                                        <th>Login</th>
                                        <th>Engajamento</th>
                                        <th>Compras</th>
                                        <th>Score Geral</th>
                                        <th>Categoria</th>
                                    </tr>
                                </thead>
                                <tbody id="top-jogadores-body">
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Jogadores em Risco - Queda em Receita -->
                    <section class="risco-section">
                        <h3><i class="fas fa-money-bill-wave"></i> Risco: Queda em Receita <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Jogadores com Score Geral < 35 onde o engajamento √© maior que as compras. Est√£o ativos no app mas n√£o convertendo em receita. Prioridade para campanhas de recupera√ß√£o de receita.</span></span></h3>
                        <div class="risco-info">
                            <p>Jogadores com score de compras menor que engajamento. Prioridade para recupera√ß√£o de receita.</p>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="risco-receita-table">
                                <thead>
                                    <tr>
                                        <th>Player ID</th>
                                        <th>Score Geral</th>
                                        <th>Score Engajamento</th>
                                        <th>Score Compras</th>
                                        <th>A√ß√£o Recomendada</th>
                                    </tr>
                                </thead>
                                <tbody id="risco-receita-body">
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- Jogadores em Risco - Queda em Engajamento -->
                    <section class="risco-section">
                        <h3><i class="fas fa-chart-line"></i> Risco: Queda em Engajamento <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Jogadores com Score Geral < 35 onde as compras s√£o maiores ou iguais ao engajamento. Baixa atividade no app. Risco iminente de churn total.</span></span></h3>
                        <div class="risco-info">
                            <p>Jogadores com score de engajamento menor ou igual ao de compras. Foco em reten√ß√£o de atividade.</p>
                        </div>
                        <div class="table-container">
                            <table class="data-table" id="risco-engajamento-table">
                                <thead>
                                    <tr>
                                        <th>Player ID</th>
                                        <th>Score Geral</th>
                                        <th>Score Engajamento</th>
                                        <th>Score Compras</th>
                                        <th>A√ß√£o Recomendada</th>
                                    </tr>
                                </thead>
                                <tbody id="risco-engajamento-body">
                                </tbody>
                            </table>
                        </div>
                    </section>
                </div>

                <!-- Tab: Clusters -->
                <div id="tab-clusters" class="tab-content">
                    <section class="clusters-section">
                        <h3><i class="fas fa-layer-group"></i> Top 50 Jogadores por Cluster <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Lista dos 50 melhores jogadores de cada categoria. Permite identificar jogadores espec√≠ficos para a√ß√µes segmentadas. Clique para expandir cada cluster.</span></span></h3>
                        <p class="clusters-desc">Visualize os melhores jogadores de cada categoria de sa√∫de. Clique para expandir.</p>
                        
                        <!-- Elite -->
                        <div class="cluster-card">
                            <div class="cluster-header" onclick="toggleCluster('elite')">
                                <div class="cluster-title">
                                    <span class="cluster-icon">üèÜ</span>
                                    <span class="cluster-name">Elite <span class="info-tooltip"><span class="tooltip-text">Top 50 jogadores com Score Geral mais alto (‚â• 80). Clientes mais valiosos da base.</span></span></span>
                                    <span class="cluster-badge badge-elite">Score ‚â• 80</span>
                                </div>
                                <div class="cluster-stats">
                                    <span id="cluster-elite-count">0 jogadores</span>
                                    <i class="fas fa-chevron-down cluster-toggle" id="cluster-elite-toggle"></i>
                                </div>
                            </div>
                            <div class="cluster-content" id="cluster-elite-content">
                                <table class="data-table cluster-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Player ID</th>
                                            <th>Score Geral</th>
                                            <th>Score Engajamento</th>
                                            <th>Score Compras</th>
                                            <th>VIP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cluster-elite-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Muito Bom -->
                        <div class="cluster-card">
                            <div class="cluster-header" onclick="toggleCluster('muito-bom')">
                                <div class="cluster-title">
                                    <span class="cluster-icon">‚úÖ</span>
                                    <span class="cluster-name">Muito Bom <span class="info-tooltip"><span class="tooltip-text">Top 50 jogadores com Score 65-79. Alto potencial de se tornarem Elite.</span></span></span>
                                    <span class="cluster-badge badge-muito-bom">Score 65-79</span>
                                </div>
                                <div class="cluster-stats">
                                    <span id="cluster-muito-bom-count">0 jogadores</span>
                                    <i class="fas fa-chevron-down cluster-toggle" id="cluster-muito-bom-toggle"></i>
                                </div>
                            </div>
                            <div class="cluster-content" id="cluster-muito-bom-content">
                                <table class="data-table cluster-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Player ID</th>
                                            <th>Score Geral</th>
                                            <th>Score Engajamento</th>
                                            <th>Score Compras</th>
                                            <th>VIP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cluster-muito-bom-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Est√°vel -->
                        <div class="cluster-card">
                            <div class="cluster-header" onclick="toggleCluster('estavel')">
                                <div class="cluster-title">
                                    <span class="cluster-icon">üìä</span>
                                    <span class="cluster-name">Est√°vel <span class="info-tooltip"><span class="tooltip-text">Top 50 jogadores com Score 50-64. Base consistente com potencial de crescimento.</span></span></span>
                                    <span class="cluster-badge badge-estavel">Score 50-64</span>
                                </div>
                                <div class="cluster-stats">
                                    <span id="cluster-estavel-count">0 jogadores</span>
                                    <i class="fas fa-chevron-down cluster-toggle" id="cluster-estavel-toggle"></i>
                                </div>
                            </div>
                            <div class="cluster-content" id="cluster-estavel-content">
                                <table class="data-table cluster-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Player ID</th>
                                            <th>Score Geral</th>
                                            <th>Score Engajamento</th>
                                            <th>Score Compras</th>
                                            <th>VIP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cluster-estavel-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Baixo -->
                        <div class="cluster-card">
                            <div class="cluster-header" onclick="toggleCluster('baixo')">
                                <div class="cluster-title">
                                    <span class="cluster-icon">‚ö†Ô∏è</span>
                                    <span class="cluster-name">Baixo <span class="info-tooltip"><span class="tooltip-text">Top 50 jogadores com Score 35-49. Requerem aten√ß√£o para evitar perda.</span></span></span>
                                    <span class="cluster-badge badge-baixo">Score 35-49</span>
                                </div>
                                <div class="cluster-stats">
                                    <span id="cluster-baixo-count">0 jogadores</span>
                                    <i class="fas fa-chevron-down cluster-toggle" id="cluster-baixo-toggle"></i>
                                </div>
                            </div>
                            <div class="cluster-content" id="cluster-baixo-content">
                                <table class="data-table cluster-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Player ID</th>
                                            <th>Score Geral</th>
                                            <th>Score Engajamento</th>
                                            <th>Score Compras</th>
                                            <th>VIP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cluster-baixo-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Risco Queda Receita -->
                        <div class="cluster-card cluster-risco">
                            <div class="cluster-header" onclick="toggleCluster('risco-receita')">
                                <div class="cluster-title">
                                    <span class="cluster-icon">üö®</span>
                                    <span class="cluster-name">Risco: Queda em Receita <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Top 50 jogadores em risco de queda de receita. Engajados mas com baixa convers√£o. Prioridade para ofertas e incentivos de compra.</span></span></span>
                                    <span class="cluster-badge badge-risco-receita">Score < 35</span>
                                </div>
                                <div class="cluster-stats">
                                    <span id="cluster-risco-receita-count">0 jogadores</span>
                                    <i class="fas fa-chevron-down cluster-toggle" id="cluster-risco-receita-toggle"></i>
                                </div>
                            </div>
                            <div class="cluster-content" id="cluster-risco-receita-content">
                                <table class="data-table cluster-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Player ID</th>
                                            <th>Score Geral</th>
                                            <th>Score Engajamento</th>
                                            <th>Score Compras</th>
                                            <th>VIP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cluster-risco-receita-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Risco Queda Engajamento -->
                        <div class="cluster-card cluster-risco">
                            <div class="cluster-header" onclick="toggleCluster('risco-engajamento')">
                                <div class="cluster-title">
                                    <span class="cluster-icon">üìâ</span>
                                    <span class="cluster-name">Risco: Queda em Engajamento <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Top 50 jogadores em risco de churn total. Baixo engajamento e compras. √öltima chance de reten√ß√£o.</span></span></span>
                                    <span class="cluster-badge badge-risco-engajamento">Score < 35</span>
                                </div>
                                <div class="cluster-stats">
                                    <span id="cluster-risco-engajamento-count">0 jogadores</span>
                                    <i class="fas fa-chevron-down cluster-toggle" id="cluster-risco-engajamento-toggle"></i>
                                </div>
                            </div>
                            <div class="cluster-content" id="cluster-risco-engajamento-content">
                                <table class="data-table cluster-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Player ID</th>
                                            <th>Score Geral</th>
                                            <th>Score Engajamento</th>
                                            <th>Score Compras</th>
                                            <th>VIP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cluster-risco-engajamento-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Tab: Benchmarks -->
                <div id="tab-benchmarks" class="tab-content">
                    <section class="benchmarks-section">
                        <h3><i class="fas fa-cogs"></i> Par√¢metros e Benchmarks <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Par√¢metros calculados dinamicamente a partir da base de jogadores. Mostra m√©dias, medianas e desvios padr√£o das principais m√©tricas. Esses valores s√£o usados como benchmarks para calcular os scores.</span></span></h3>
                        
                        <div class="benchmarks-grid" id="benchmarks-grid">
                            <!-- Benchmarks ser√£o inseridos aqui via JS -->
                        </div>

                        <div class="chart-row">
                            <div class="chart-card">
                                <h4><i class="fas fa-chart-bar"></i> M√©dias por M√©trica (3 dias) <span class="info-tooltip tooltip-wide"><span class="tooltip-text">Compara√ß√£o das m√©dias de cada m√©trica (torneios, maratonas, miss√µes, promo√ß√µes, logins) considerando apenas jogadores que participaram de cada atividade (m√©dia sem zeros).</span></span></h4>
                                <canvas id="benchmarksChart"></canvas>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Export Actions -->
                <section class="export-section">
                    <h3><i class="fas fa-download"></i> Exportar Resultados <span class="info-tooltip"><span class="tooltip-text">Exporte os dados completos da an√°lise em formato CSV ou Excel para an√°lises externas.</span></span></h3>
                    <div class="export-actions">
                        <button class="btn btn-export" onclick="exportCSV()">
                            <i class="fas fa-file-csv"></i> Exportar CSV
                        </button>
                        <button class="btn btn-export" onclick="exportExcel()">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                    </div>
                </section>
            </div>

            <!-- Loading -->
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <span>Processando dados...</span>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Health Score Dashboard ¬© 2026 - An√°lise de Engajamento de Jogadores</p>
        </footer>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
